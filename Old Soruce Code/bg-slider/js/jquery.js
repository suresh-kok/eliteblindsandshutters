/**
 * Backslider - Fullscreen Background Image Slider 
 * http://plugins.gravitysign.com/backslider
 * Copyright (c) 2013 Roman Yurchuk
 * Version 1.8.2
*/

(function(b){Function.prototype.scope=function(e){var d=this;return function(){d.apply(e,Array.prototype.slice.call(arguments))}};function a(e,d){this.container=b(e);this.settings=d;if(this.container.find(".bs-slides").length==0){this.container.append('<ul class="bs-slides"></ul>')}if(this.settings.photoSource=="flickrfeed"){this.photoSourceFlickrFeed()}else{if(this.settings.photoSource=="flickrauth"){this.photoSourceFlickrAuth()}else{if(this.settings.photoSource=="picasa"){this.photoSourcePicasa()}else{this.init()}}}}a.prototype.init=function(){this.slides=this.container.find(".bs-slides > li");this.length=this.slides.length;if(this.settings.startRandom){this.index=Math.floor(Math.random()*(this.length-1))}else{this.index=this.settings.startSlide||0}this.container.prepend('<div class="bs-overlay"></div>');this.container.prepend('<div class="bs-controls"></div>');if(this.settings.preload){this.container.prepend('<div class="bs-preload"><div class="bs-preload-indicator"></div></div>')}this.preloadTimer=window.setInterval((function(){var f=this.slides.find("img").filter(function(){return !this.complete}).length;if(f==0){window.clearInterval(this.preloadTimer);if(this.settings.preload){var e=this.container.find(".bs-preload");e.delay(this.settings.preloadDelay).fadeTo(this.settings.preloadTime,0,(function(){this.container.find(".bs-controls").fadeIn("fast");e.remove()}).scope(this))}else{this.container.find(".bs-controls").fadeIn("fast")}this.slides.find("img").each(function(){b(this).attr("data-width",this.width).attr("data-height",this.height)});this.imageScaleMode();this.centerImages();this.settings.slidesLoaded.scope(this.container.get(0))(this.length)}}).scope(this),200);this.slides.not(":eq("+this.index+")").hide();if(this.settings.effect=="slidefade"){var c=100+Math.abs(this.settings.slidefadeOffsetX)*100/this.container.width();var d=100+Math.abs(this.settings.slidefadeOffsetY)*100/this.container.height();this.slides.css({width:c.toFixed(3)+"%",height:d.toFixed(3)+"%"})}b(window).resize((function(){this.imageScaleMode();this.centerImages()}).scope(this));this.container.bind("backslider",(function(h,f,g){if(typeof this[f]=="function"){this[f].scope(this)(g)}h.stopPropagation()}).scope(this));this.settings.mode=this.modes.hasOwnProperty(this.settings.mode)?this.settings.mode:"timer";this.settings.effect=this.effects.hasOwnProperty(this.settings.effect)?this.settings.effect:"fade";this.modes[this.settings.mode].scope(this)()};a.prototype.modes={timer:function(){b('<a class="bs-timer" href="#bs"></a>').click((function(c){(this.timer)?this.pause():this.resume();c.preventDefault()}).scope(this)).appendTo(this.container.find(".bs-controls"));this.resume()},scroll:function(){var c=0,d=0;b('<div class="bs-scroll"></div>').appendTo(this.container.find(".bs-controls"));b(window).bind("resize",(function(){d=(b(document).height()-b(window).height())/(this.length-1)}).scope(this)).trigger("resize");if(d>0){b(window).bind("scroll",(function(){c=Math.floor(b(window).scrollTop()/d);if(this.index!=c){window.clearTimeout(this.timer);this.timer=window.setTimeout((function(){this.slides.stop(true,true);if(this.index!=c){this.skip(c)}}).scope(this),this.settings.scrollTimeout)}}).scope(this))}},controls:function(){b('<a class="bs-previous" href="#bs"></a>').click((function(c){this.previous();c.preventDefault()}).scope(this)).appendTo(this.container.find(".bs-controls"));b('<a class="bs-next" href="#bs"></a>').click((function(c){this.next();c.preventDefault()}).scope(this)).appendTo(this.container.find(".bs-controls"))},pagination:function(){for(var c=0;c<this.length;c++){(function(d){b('<a class="bs-pagination" href="#bs'+d+'"></a>').click((function(f){this.skip(d);f.preventDefault()}).scope(this)).appendTo(this.container.find(".bs-controls"))}).scope(this)(c)}this.skip(this.index);this.updateControls()},thumbnails:function(){var f=this.settings.thumbnailsTime;var c=this.settings.thumbnailsOpacity;var e=parseInt(this.settings.thumbnailsSize,10)+"px";for(var d=0;d<this.length;d++){(function(i){var h=this.slides.eq(i).find("img");var g=new Image();g.alt=h.attr("alt");b(g).bind("load",function(){b(this).css((g.width/g.height>1)?"height":"width",e);b(this).removeAttr("width").removeAttr("height")}).hover(function(){b(this).stop().fadeTo(f,1)},function(){if(!b(this).parent().hasClass("bs-active")){b(this).stop().fadeTo(f,c)}}).css("opacity",c);g.src=h.attr("src");b('<a class="bs-thumbnails" href="#bs'+i+'"></a>').css({width:e,height:e}).click((function(j){this.skip(i);j.preventDefault()}).scope(this)).append(g).appendTo(this.container.find(".bs-controls"))}).scope(this)(d)}this.skip(this.index);this.updateControls()}};a.prototype.effects={fade:function(e,d){this.settings.beforeSlide.scope(this.container.get(0))(this.index,this.length);e.stop().fadeOut(this.settings.effectTime/2,this.settings.effectEasing,(function(){d.stop().fadeIn(this.settings.effectTime/2,this.settings.effectEasing,(function(){this.settings.afterSlide.scope(this.container.get(0))(this.index,this.length)}).scope(this))}).scope(this))},crossfade:function(e,d){this.settings.beforeSlide.scope(this.container.get(0))(this.index,this.length);e.stop().fadeOut(this.settings.effectTime,this.settings.effectEasing);d.stop().fadeIn(this.settings.effectTime,this.settings.effectEasing,(function(){this.settings.afterSlide.scope(this.container.get(0))(this.index,this.length)}).scope(this))},slidefade:function(f,e){var d={left:this.settings.slidefadeOffsetX,top:this.settings.slidefadeOffsetY,x:0,y:0};if(this.settings.slidefadeOffsetX>0){d.x=-this.settings.slidefadeOffsetX;d.left=0}if(this.settings.slidefadeOffsetY>0){d.y=-this.settings.slidefadeOffsetY;d.top=0}this.settings.beforeSlide.scope(this.container.get(0))(this.index,this.length);f.css("z-index","").stop().fadeOut(this.settings.effectTime,this.settings.effectEasing);e.css(b.extend({display:"block",opacity:0,"z-index":20},d)).stop().animate({opacity:1,top:d.y,left:d.x},this.settings.effectTime,this.settings.effectEasing,(function(){this.settings.afterSlide.scope(this.container.get(0))(this.index,this.length)}).scope(this))},slide:function(f,e){var d=this.container.children(".bs-coverslide");if(!d.length){d=b('<div class="bs-coverslide"><img src="" alt="Cover Slide"></div>');d.prependTo(this.container)}this.settings.beforeSlide.scope(this.container.get(0))(this.index,this.length);d.find("img").attr("src",f.find("img").attr("src")).css({position:"relative",top:f.find("img").position().top,left:f.find("img").position().left,width:f.find("img").width(),height:f.find("img").height()});d.css("width","0%").stop(true).animate({width:"100%"},this.settings.effectTime,this.settings.effectEasing,(function(){this.settings.afterSlide.scope(this.container.get(0))(this.index,this.length)}).scope(this));e.css("left",this.settings.slideOffset).show().stop(true,true).animate({left:"0px"},this.settings.effectTime,this.settings.effectEasing);f.hide()}};a.prototype.next=function(){this.slides.stop(true,true);this.effects[this.settings.effect].scope(this)(this.currentSlide(),this.nextSlide());this.updateControls();this.reset()};a.prototype.previous=function(){var c=this.index;this.slides.stop(true,true);this.effects[this.settings.effect].scope(this)(this.currentSlide(),this.previousSlide());this.updateControls();this.reset()};a.prototype.skip=function(d){if(this.index!=d){var c=this.index;this.slides.stop(true,true);this.effects[this.settings.effect].scope(this)(this.currentSlide(),this.positionSlide(d));this.updateControls();this.reset()}};a.prototype.pause=function(){if(this.settings.mode=="timer"){this.container.find(".bs-timer").stop().fadeTo("fast",0,function(){b(this).css("background-position","0px -80px").fadeTo("fast",1)});window.clearInterval(this.timer);this.timer=0}};a.prototype.resume=function(){if(this.settings.mode=="timer"){var c=this.container.find(".bs-timer");c.stop().fadeTo("fast",0,function(){b(this).css("background-position","-20px 0px").fadeTo("fast",1)});var d=0;this.timer=window.setInterval((function(){c.css("background-position","0px "+(-20*d)+"px");d=d+1;if(d==4){this.next();d=0}}).scope(this),this.settings.timerDelay/4)}};a.prototype.reset=function(){this.pause();this.resume()};a.prototype.currentSlide=function(){return this.slides.eq(this.index)};a.prototype.nextSlide=function(){this.index=(this.index<this.length-1)?this.index+1:0;return this.currentSlide()};a.prototype.previousSlide=function(){this.index=(this.index>0)?this.index-1:this.length-1;return this.currentSlide()};a.prototype.positionSlide=function(c){this.index=parseInt(c,10);return this.currentSlide()};a.prototype.updateControls=function(){if(this.settings.mode=="pagination"){this.container.find(".bs-pagination").removeClass("bs-active").eq(this.index).addClass("bs-active")}if(this.settings.mode=="thumbnails"){this.container.find(".bs-active").removeClass("bs-active").children("img").stop().fadeTo(this.settings.thumbnailsTime,this.settings.thumbnailsOpacity);this.container.find(".bs-thumbnails:eq("+this.index+")").addClass("bs-active").children("img").css("opacity",1)}};a.prototype.imageScaleMode=function(){var c=this.container.width()/this.container.height();this.slides.find("img").each(function(){if(this.height>0){var d=this.width/this.height;this.className=(c>d)?"bs-landscape":"bs-portrait"}else{this.className="bs-landscape"}})};a.prototype.centerImages=function(){if(this.settings.centerImages){var c=this.container;this.slides.find("img").each(function(){var d=b(this),f=0;var e=d.data("width")/d.data("height");if(d.hasClass("bs-landscape")){f=-(c.width()/e-c.height())/2;if(f>0){f=0}d.css({position:"relative",top:f,left:0})}else{f=-(c.height()*e-c.width())/2;if(f>0){f=0}d.css({position:"relative",top:0,left:f})}})}};a.prototype.getPhotoRange=function(e){var f=/(\d+)-(\d+)/g,d;while(d=f.exec(e)){var c="";for(var g=parseInt(d[1],10);g<=parseInt(d[2],10);g++){c+=g+","}e=e.replace(d[0],c.substr(0,c.length-1))}return e};a.prototype.photoSourceFlickrFeed=function(){var e="https://api.flickr.com/services/feeds/photoset.gne";var d="";for(var c in this.settings.flickrFeedQuery){d+=c+"="+this.settings.flickrFeedQuery[c]+"&"}d+="lang=en-us&format=json&jsoncallback=?";b.getJSON(e,d,(function(g){var h="";var f=this.getPhotoRange(this.settings.photoRange);b.each(g.items,function(j,k){if(f===""||f.search(new RegExp("\\b"+j+"\\b"))!=-1){h+='<li><img src="'+k.media.m.replace("_m","_b")+'" alt="'+k.title.replace('"',"'")+'"></li>';h+="\r\n"}});this.container.find(".bs-slides").html(h);this.init()}).scope(this))};a.prototype.photoSourceFlickrAuth=function(){var e="https://api.flickr.com/services/rest/";var d="";for(var c in this.settings.flickrAuthQuery){d+=c+"="+this.settings.flickrAuthQuery[c]+"&"}d+="method=flickr.photosets.getPhotos&extras=url_o&format=json&jsoncallback=?";b.getJSON(e,d,(function(g){var h="";var f=this.getPhotoRange(this.settings.photoRange);b.each(g.photoset.photo,function(j,k){if(f===""||f.search(new RegExp("\\b"+j+"\\b"))!=-1){h+='<li><img src="'+k.url_o+'" alt="'+k.title.replace('"',"'")+'"></li>';h+="\r\n"}});this.container.find(".bs-slides").html(h);this.init()}).scope(this))};a.prototype.photoSourcePicasa=function(){var d="https://picasaweb.google.com/data/feed/base/user/"+this.settings.picasaQuery.user+"/albumid/"+this.settings.picasaQuery.album;var c="alt=json&kind=photo&hl=en_US&fields=entry(title,media:group(media:content))";b.getJSON(d,c,(function(f){var g="";var e=this.getPhotoRange(this.settings.photoRange);b.each(f.feed.entry,function(j,l){if(e===""||e.search(new RegExp("\\b"+j+"\\b"))!=-1){var h=l.title.$t.replace('"',"'");var k=l.media$group.media$content[0].url;g+='<li><img src="'+k+'" alt="'+h+'"></li>';g+="\r\n"}});this.container.find(".bs-slides").html(g);this.init()}).scope(this))};b.fn.backslider=function(d){var c=b.extend(true,{mode:"controls",effect:"fade",effectTime:1500,effectEasing:"swing",slideOffset:50,slidefadeOffsetX:0,slidefadeOffsetY:-50,timerDelay:5000,scrollTimeout:200,preload:true,preloadTime:1000,preloadDelay:200,startSlide:0,startRandom:false,thumbnailsSize:"40px",thumbnailsOpacity:0.5,thumbnailsTime:500,centerImages:false,photoSource:"none",photoRange:"",flickrFeedQuery:{set:"00000000",nsid:"00000000@N00"},flickrAuthQuery:{api_key:"00000000",photoset_id:"00000000"},picasaQuery:{user:"username",album:"00000000"},beforeSlide:function(){},afterSlide:function(){},slidesLoaded:function(){}},d);if(this.length){this.data("backslider",new a(this,c))}return this}})(jQuery);