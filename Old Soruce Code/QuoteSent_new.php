<?php
session_start();
error_reporting(0);
?>
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elite Blinds &amp; Shutters</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/vendor/modernizr.js"></script>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/styles/monokai.min.css">
    <link href="css/foundation-icons.css" rel="stylesheet">
    <script src="js/ga.js" async type="text/javascript"></script>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta name="SKYPE_TOOLBAR" content ="SKYPE_TOOLBAR_PARSER_COMPATIBLE"/>
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<link href='http://fonts.googleapis.com/css?family=Lato:400,100,300,700,900' rel='stylesheet' type='text/css' />
<script type="text/javascript" src="https://stats.directclicks.com.au/javascripts/email_counter_jquery.js"></script>
<script type="text/javascript" src="https://stats.directclicks.com.au/email/unconditional_counter/"></script>
  <link rel="stylesheet" href="backslider/css/supersized.css" type="text/css" media="screen" />
<link rel="stylesheet" href="backslider/theme/supersized.shutter.css" type="text/css" media="screen" />
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
		<script type="text/javascript" src="backslider/js/supersized.3.2.7.min.js"></script>
		<script type="text/javascript" src="backslider/theme/supersized.shutter.min.js"></script>	
     <script type="text/javascript">
			jQuery(function($){
				$.supersized({
					// Functionality
					slide_interval          :   3000,		// Length between transitions
					transition              :   5, 			// 0-None, 1-Fade, 2-Slide Top, 3-Slide Right, 4-Slide Bottom, 5-Slide Left, 6-Carousel Right, 7-Carousel Left
					transition_speed		:	700,		// Speed of transition
					// Components							
					slide_links				:	'blank',	// Individual links for each slide (Options: false, 'num', 'name', 'blank')
					slides 					:  	[			// Slideshow Images
														{image : 'images/01.jpg', title : 'Elite Blinds &amp; Shutters'},
														{image : 'images/02.jpg', title : 'Elite Blinds &amp; Shutters'},
														{image : 'images/03.jpg', title : 'Elite Blinds &amp; Shutters'},
												]
				});
		    });
		</script>   
  </head>
  <body>
<a id="prevslide" class="load-item"></a>
<a id="nextslide" class="load-item"></a>
  

  <div class="row">
  <div class="large-12 medium-12 columns">
  <div class="large-3 medium-3 columns">
  <div class="logo"> 
  <a href="index.html" title="Elite Blinds &amp; Shutters"><img src="images/logo.jpg" alt="Elite Blinds &amp; Shutters"></a>
  </div>
  <div class="sticky ">
  <nav role="navigation" data-topbar="" class="top-bar">
  <ul class="title-area">
    <!-- Title Area -->
    <li class="name">

    </li>
    <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    <li class="toggle-topbar menu-icon"><a href=""><span>Menu</span></a></li>
  </ul>

  
<section class="top-bar-section" style="left: 0px;">
    <ul class="text-center">
       <li><a href="index.html" title="Home">HOME</a></li>
       <li><a href="about.html" title="About Us">ABOUT US</a></li>
       <li class="has-dropdown active"><a href="collections.html" title="COLLECTIONS">COLLECTIONS</a>
       <ul class="dropdown">
       		<!--<li><a href="collections.html" title="Collections">COLLECTIONS</a></li>-->
       		<li class="has-dropdown"><a href="#" title="Plantation Shutters">PLANTATION SHUTTERS</a>
            	<ul class="dropdown">
                	<!--<li><a href="plantation-shutters.html" title="Plantation Shutters">PLANTATION SHUTTERS</a></li>-->
                	<li><a href="basswood-shutters.html" title="Basswood Shutters">BASSWOOD SHUTTERS</a></li>
                    <li><a href="cedar-shutters.html" title="Cedar Shutters">CEDAR SHUTTERS</a></li>
                    <li><a href="pvc-shutters.html" title="PVC Shutters">PVC SHUTTERS</a></li>
                    <li><a href="aluminium-shutters.html" title="Aluminium Shutters">ALUMINIUM SHUTTERS</a></li>
                </ul>
            </li>
            <li><a href="venetian-blinds.php" title="Venetian Blinds">VENETIAN BLINDS</a></li>
            <li><a href="roller-blinds.php" title="Roller Blinds">ROLLER BLINDS</a></li>
            <li><a href="vertical-blinds.php" title="Vertical Blinds">VERTICAL BLINDS</a></li>
            <li><a href="panel-glides.html" title="Panel Glides">PANEL GLIDES</a>
            <li><a href="flyscreens.html" title="Flyscreens">FLYSCREENS</a>
            <li><a href="indoor-outdoor.html" title="Indoor &amp; Outdoor Furniture">INDOOR &amp; OUTDOOR FURNITURE</a></li>
             
            <li><a href="security-doors.html" title="Security Doors">SECURITY DOORS</a></li>
            <li><a href="flooring.html" title="Flooring">FLOORING</a></li>
            <li><a href="painting-wallart.html" title="Paintings &amp; Wall Art">PAINTINGS &amp; WALL ART</a></li>
            <li><a href="homewares.html" title="Homewares">HOMEWARES</a></li>
       </ul>
       </li>
       <li><a href="promotions.html" title="Promotions">PROMOTIONS</a></li><li><a href="contact-us.html" title="Contact">CONTACT</a></li>
    </ul>
    <!-- Right Nav Section -->
    
  </section></nav>
  </div>
  </div>
  <div class="large-9 medium-9 columns">
  <div class="large-12 medium-12">
<div class="call-sec">
	<a href="tel:1300 892 674">1300 892 674</a>
</div>
</div>
<div class="clearfix"></div>
<div class="large-11 medium-11 columns pad-left">
<div class="wrapper">
<h1>Make Payment</h1>








<?php

    //$email= 'tahirm@eliteblindsandshutters.com.au,enquiries@directclicks.com.au';
    $email= 'tahirm@eliteblindsandshutters.com.au,enquiries@directclicks.com.au';


if ($_GET['sent'] == "yes") {
    /* $contact_name=addslashes($_POST['contact_name']);
      $contact_phone=addslashes($_POST['contact_phone']);
      $contact_email=addslashes($_POST['contact_email']);
      $contact_mobile=addslashes($_POST['contact_mobile']);
      $query_description=addslashes($_POST['query_description']);
      $address=addslashes($_POST['address']);
      $suburb=addslashes($_POST['suburb']);
      $day=date('j');$month=date('n');$year=date('Y');


      //check if the client already exists
      $query = mysql_query("SELECT * FROM `clients` WHERE `ipaddress`='".$_SERVER['REMOTE_ADDR']."' OR `email`='".mysql_real_escape_string($_POST['contact_email'])."'");
      //$query = mysql_query("SELECT * FROM `clients` WHERE `id`='90000'");
      if(mysql_num_rows($query) >= 1){
      //update client
      $client = mysql_fetch_assoc($query);
      mysql_query("UPDATE `clients` SET
      `ipaddress`='".$_SERVER['REMOTE_ADDR']."',
      `status`='1',
      `contact`='1',
      `name` = '".$contact_name."',
      `surname` = '".$contact_surname."',
      `phone` = '".$contact_phone."',
      `mobile` = '".$contact_mobile."',
      `email` = '".$contact_email."',
      `address` = '".$address."',
      `suburb` = '".$suburb."',
      `state`='".$_POST['state']."',
      `post_code` = '".$_POST['postcode']."',
      `contactday` = '".$day."',
      `contactmonth` = '".$month."',
      `contactyear` = '".$year."' WHERE `id`= '".$client['id']."'");
      $client_id = $client['id'];
      }else{
      //create client
      mysql_query("INSERT INTO `clients` SET
      `ipaddress`='".$_SERVER['REMOTE_ADDR']."',
      `status`='1',
      `contact`='1',
      `name` = '".$contact_name."',
      `surname` = '".$contact_surname."',
      `phone` = '".$contact_phone."',
      `mobile` = '".$contact_mobile."',
      `email` = '".$contact_email."',
      `address` = '".$address."',
      `suburb` = '".$suburb."',
      `state`='".$_POST['state']."',
      `post_code` = '".$_POST['postcode']."',
      `origin` = 'website',
      `contactday` = '".$day."',
      `contactmonth` = '".$month."',
      `contactyear` = '".$year."'");

      $client_id = mysql_insert_id();
      }

      //create order
      mysql_query("INSERT INTO `orders` SET
      `client`='".$client_id."',
      `accepted`= NOW(),
      `total`='".$_SESSION['total']."',
      `message`='".$query_description."',
      `deliveryfee`='".$_SESSION['delivery']."',
      `day`='".$day."',
      `month`='".$month."',
      `year`='".$year."'
      ");
      $order_id = mysql_insert_id();

      //add items to the order
      $counter = 1;
      $ordertotal='';
      foreach($_POST['item'] as $item){
      $qty = ($item['width']/1000)*($item['height']/1000);
      $qty = $qty*$item['qty'];
      $ppsm = $item['price']/$qty;
      $desc = "Supply ".mysql_real_escape_string($item['colour'])." (".mysql_real_escape_string($item['material']).") to suit Width:".$item['width']."mm"." Height:".$item['height']."mm";
      mysql_query("
      UPDATE `orders` SET
      `qty".$counter."`='".$qty."',
      `desc".$counter."`='".$desc."',
      `amount".$counter."`='".$ppsm."'
      WHERE `id`= '".$order_id."'
      ");

      //create info for email
      $ordertotal .= 'Qty : '.$item['qty'].'
      '.$item['material'].' - '.$item['width'].' mm wide x '.$item['height'].' mm high
      Color : '.$item['colour'].'
      Fitted :   '.$item['fitted'].'
      Pull Cord Side : Right   Tilt Cord Side : Left

      ' ;

      $counter++;
      }

     * 
     */
    $contact_name = addslashes($_POST['contact_name']);
    $contact_phone = addslashes($_POST['contact_phone']);
    $contact_email = addslashes($_POST['contact_email']);
    $contact_mobile = addslashes($_POST['contact_mobile']);
    $query_description = addslashes($_POST['query_description']);
    $address = addslashes($_POST['address']);
    $suburb = addslashes($_POST['suburb']);



///create client
    $result = mysql_query("SELECT * FROM `clients` WHERE `ipaddress`='" . $_SERVER['REMOTE_ADDR'] . "' OR `email`='" . $contact_email . "'", $dbh);
    $result_row = mysql_fetch_assoc($result);

    $day = date('j');
    $month = date('n');
    $year = date('Y');

    if (!$result_row) {
	$result = mysql_query("SELECT `id` FROM  `clients` ORDER BY `id` ASC", $dbh);
	$result_row = mysql_fetch_assoc($result);
	@mysql_data_seek($result, 0);

	$clientidnumber = 0;

	while ($result_row = mysql_fetch_assoc($result)) {  //find new usernumber
	    if ($result_row['id'] > $clientidnumber) {
		$clientidnumber = $result_row['id'];
	    }
	}
	$clientidnumber = $clientidnumber + 1;

	mysql_query("INSERT INTO `clients` 
(`id`, `ipaddress`, `status`, `contact`, `name`, `surname`, `email`, `phone`, `contactday`, `contactmonth`, `contactyear`, `origin`,`address`,`suburb`,`state`,`post_code`) VALUES 
('" . $clientidnumber . "', '" . $_SERVER['REMOTE_ADDR'] . "', '1', '1', '" . $contact_name . "', '" . $contact_surname . "', '" . $contact_email . "', '" . $contact_phone . "','" . $day . "', '" . $month . "', '" . $year . "', 'website', '" . $address . "',    '" . $suburb . "',   '" . $_POST['state'] . "',   '" . $_POST['postcode'] . "'    )", $dbh);
    } else {
	$clientidnumber = $result_row['id'];

	$client_result = mysql_query("UPDATE `clients` SET 
				`ipaddress`='" . $_SERVER['REMOTE_ADDR'] . "',
				`status`='1',
				`contact`='1',
				`name` = '" . $contact_name . "',
				`surname` = '" . $contact_surname . "',
				`phone` = '" . $contact_phone . "',
				`mobile` = '" . $contact_mobile . "',
				`email` = '" . $contact_email . "',
				`address` = '" . $address . "',
				`suburb` = '" . $suburb . "',
				`state`='" . $_POST['state'] . "',
				`post_code` = '" . $_POST['postcode'] . "',
				`contactday` = '" . $day . "',
				`contactmonth` = '" . $month . "',
				`contactyear` = '" . $year . "' WHERE `id`= '" . $result_row['id'] . "' ", $dbh);
    }





///generate order id
    $result = mysql_query("SELECT id FROM `orders` ORDER BY  `id`  ASC", $dbh);
    $result_row = mysql_fetch_assoc($result);
    @mysql_data_seek($result, 0);

    $order_id = 0;

    while ($result_row = mysql_fetch_assoc($result)) {  //find new usernumber
	if ($result_row['id'] > $order_id) {
	    $order_id = $result_row['id'];
	}
    }
    $order_id = $order_id + 1;

//update
    $total = 0;
    $counter = 1;
    foreach ($_SESSION['items'] as $item) {
	$total = $total + $item['price'];
	$_SESSION['quantity' . $counter] = $item['qty'];
	if ($item['type'] == "double") {
	    $_SESSION['material' . $counter] = $item['material'] . " and " . $item['material2'];
	} else {
	    $_SESSION['material' . $counter] = $item['material'];
	}
	if ($item['type'] == "double") {
	    $_SESSION['colour' . $counter] = $item['colour'] . " and " . $item['colour'];
	} else {
	    $_SESSION['colour' . $counter] = $item['colour'];
	}

	$_SESSION['width' . $counter] = $item['width'];
	$_SESSION['height' . $counter] = $item['height'];

	$_SESSION['thisunit' . $counter] = $item['unit_price'];
	
	if(isset($item['type'])){
	    //it is a roller blind
	    $_SESSION['desc' . $counter] = "Type: " . $item['type'] . " roller\n";
	    $_SESSION['desc' . $counter] .= "Material: " . $item['material'] . "\n";
	    $_SESSION['desc' . $counter] .= "Colour: " . $item['colour'] . "\n";
	    if ($item['type'] == "double") {
		$_SESSION['desc' . $counter] .= "Material 2: " . $item['material2'] . "\n";
		$_SESSION['desc' . $counter] .= "Colour 2: " . $item['colour2'] . "\n";
	    }
	    $_SESSION['desc' . $counter] .= "Width: " . $item['width'] . "\n";
	    $_SESSION['desc' . $counter] .= "Height: " . $item['height'] . "\n";
	    $_SESSION['desc' . $counter] .= "Chain: " . $item['chain'] . "\n";
	    $_SESSION['desc' . $counter] .= "Rail: " . $item['rail'] . "\n";
	    $_SESSION['desc' . $counter] .= "Cord: " . $item['cord'] . "\n";
	    $_SESSION['desc' . $counter] .= "Mount: " . $item['mount'] . "\n";
	    $_SESSION['desc' . $counter] .= "Roll: " . $item['roll'] . "\n";
	    $_SESSION['desc' . $counter] .= "Qty: " . $item['qty'] . "\n";
	}else{
	    //it is a vertical blind
	    $_SESSION['desc' . $counter] .= "Type: Vertical Blinds\n";
	    $_SESSION['desc' . $counter] .= "Material: " . $item['material'] . "\n";
	    $_SESSION['desc' . $counter] .= "Colour: " . $item['colour'] . "\n";
	    $_SESSION['desc' . $counter] .= "Slat Width: " . $item['slat_width'] . "\n";
	    $_SESSION['desc' . $counter] .= "Width: " . $item['width'] . "\n";
	    $_SESSION['desc' . $counter] .= "Height: " . $item['height'] . "\n";
	    $_SESSION['desc' . $counter] .= "Cord: " . $item['cord'] . "\n";
	    $_SESSION['desc' . $counter] .= "Qty: " . $item['qty'] . "\n";
	}

	

	$counter++;
    }

    //$_SESSION['total'] = round($total, 2) + $_SESSION['delivery'];

    mysql_query("INSERT INTO `orders`  (`id`, `client`, `accepted`,`total` ,`message`,`payoption`,`deliveryfee`,`day`,`month`,`year`) VALUES 
('" . $order_id . "', '" . $clientidnumber . "',   NOW(), '" . $_SESSION['total'] . "' , '" . $query_description . "', '" . $_POST['cardtype'] . "','" . $_SESSION['delivery'] . "' ,'" . date('j') . "' ,'" . date('n') . "' ,'" . date('Y') . "')", $dbh);






/// send to...
    $ordertotal = '';

    $order = 1;
    while ($order < 29) {
	//Color : '.$_POST['color'.$order].' Fitted :   '.$_POST['fitted'.$order].'   Holddowns : '.$_POST['holddowns'.$order].' Pull Cord Side : Right   Tilt Cord Side : Left


	if ($_SESSION['width' . $order] != "") {
	    //$ordertotal = $ordertotal . $_SESSION['quantity' . $order] . ' x ' . $_SESSION['material' . $order] . ' (' . $_SESSION['colour' . $order] . ') - ' . $_SESSION['width' . $order] . ' mm wide x ' . $_SESSION['height' . $order] . ' mm high. Fitted: ' . $_SESSION['fitted' . $order] . '. Pull Cord Side : Right.   Tilt Cord Side : Left.';
	    $order_desc = $_SESSION['desc' . $order];

	    $ordertotal = $ordertotal . "\n\n" . $order_desc;

	    $thiswidth = $_SESSION['width' . $order] / 1000;
	    $thisheight = $_SESSION['height' . $order] / 1000;
	    $thisarea = ($thiswidth * $thisheight) * $_SESSION["quantity" . $order];



	    mysql_query("UPDATE `orders` SET 
`qty" . $order . "` ='" . $thisarea . "',
`desc" . $order . "` ='" . $order_desc . "',
`amount" . $order . "` ='" . $_SESSION['thisunit' . $order] . "' 
WHERE `id`= '" . $order_id . "' ", $dbh);
//Pull Cord Side : '.$_POST['pullcordside'.$order].'   Tilt Cord Side : '.$_POST['tiltcordside'.$order].'
	}

	$order = $order + 1;
    }
    //send them emails
    $message = "The following is an order from your website:\n\n";

    //$message.= "You can view and print the invoice for this order at this link : http://www.competeblinds.com.au/invoice.php?id=" . $order_id . "\n\n";
    //$message.= "Invoice/order number : #" . $order_id . "\n\n";

    $message .= "Persons name: " . $contact_name . "\n";
    $message .= "Persons email: " . $contact_email . "\n";
    $message .= "Phone number: " . $contact_phone . "\n";
    $message .= "Mobile phone number: " . $contact_mobile . "\n";
    $message .= "Address: " . $address . ", " . $suburb . " " . $_POST['state'] . " " . $_POST['postcode'] . "\n";
    $message .= "Comments : " . $query_description . "\n\n";

    $message .= "ORDER DETAILS: \n\n";

    $message .= "" . $ordertotal . "\n\n";

    $message .= "Delivery : $" . $_SESSION['delivery'] . "\n";
    $message .= "Total : $" . $_SESSION['total'] . " (inc delivery) \n";

    $headers = "From: " . $contact_email . "\r\nReply-To: " . $contact_email . "";

    mail($email, '800242 - Website ' . $readytext . ' Order', $message, $headers);


    ///email to client


    $message = "Thank you for placing an order with Woodnation.com.au.  Please visit our website at http://www.competeblinds.com.au/ again soon.

A copy of your order is shown below :

";

    $message .= "Your name: " . $contact_name . "\n";
    $message .= "Email: " . $contact_email . "\n";
    $message .= "Phone number: " . $contact_phone . "\n";
    $message .= "Mobile phone number: " . $contact_mobile . "\n";
    $message .= "Address: " . $address . ", " . $suburb . " " . $_POST['state'] . " " . $_POST['postcode'] . "\n";
    $message .= "Comments : " . $query_description . "\n\n";

    $message .= "ORDER DETAILS: \n";

    $message .= "" . $ordertotal . "\n\n";

    $message .= "Delivery : $" . $_SESSION['delivery'] . "\n";
    $message .= "Total : $" . $_SESSION['total'] . " (inc delivery) 
					
Please contact us if you wish to discuss or change your order.

Kind Regards,

Woodnation pty ltd.
http://www.competeblinds.com.au/
Abn. 16 130 829 417
Ph. 1300 800 118";

    $headers = "From: " . $email . "\r\nReply-To: " . $email . "";

    mail($contact_email, '800242 - Website ' . $readytext . ' Order', $message, $headers);
}

function checkCreditCard($cardnumber, $cardname, &$errornumber, &$errortext) {

    // Define the cards we support. You may add additional card types.
    //  Name:      As in the selection box of the form - must be same as user's
    //  Length:    List of possible valid lengths of the card number for the card
    //  prefixes:  List of possible prefixes for the card
    //  checkdigit Boolean to say whether there is a check digit
    // Don't forget - all but the last array definition needs a comma separator!

    $cards = array(array('name' => 'American Express',
	    'length' => '15',
	    'prefixes' => '34,37',
	    'checkdigit' => true
	),
	array('name' => 'Carte Blanche',
	    'length' => '14',
	    'prefixes' => '300,301,302,303,304,305,36,38',
	    'checkdigit' => true
	),
	array('name' => 'Diners Club',
	    'length' => '14',
	    'prefixes' => '300,301,302,303,304,305,36,38',
	    'checkdigit' => true
	),
	array('name' => 'Discover',
	    'length' => '16',
	    'prefixes' => '6011',
	    'checkdigit' => true
	),
	array('name' => 'Enroute',
	    'length' => '15',
	    'prefixes' => '2014,2149',
	    'checkdigit' => true
	),
	array('name' => 'JCB',
	    'length' => '15,16',
	    'prefixes' => '3,1800,2131',
	    'checkdigit' => true
	),
	array('name' => 'Maestro',
	    'length' => '16,18',
	    'prefixes' => '5020,6',
	    'checkdigit' => true
	),
	array('name' => 'MasterCard',
	    'length' => '16',
	    'prefixes' => '51,52,53,54,55',
	    'checkdigit' => true
	),
	array('name' => 'Solo',
	    'length' => '16,18,19',
	    'prefixes' => '6334,6767',
	    'checkdigit' => true
	),
	array('name' => 'Switch',
	    'length' => '16,18,19',
	    'prefixes' => '4903,4905,4911,4936,564182,633110,6333,6759',
	    'checkdigit' => true
	),
	array('name' => 'Visa',
	    'length' => '13,16',
	    'prefixes' => '4',
	    'checkdigit' => true
	),
	array('name' => 'Visa Electron',
	    'length' => '16',
	    'prefixes' => '417500,4917,4913',
	    'checkdigit' => true
	)
    );

    $ccErrorNo = 0;

    $ccErrors [0] = "Unknown card type";
    $ccErrors [1] = "No card number provided";
    $ccErrors [2] = "Credit card number has invalid format";
    $ccErrors [3] = "Credit card number is invalid";
    $ccErrors [4] = "Credit card number is wrong length";

    // Establish card type
    $cardType = -1;
    for ($i = 0; $i < sizeof($cards); $i++) {

	// See if it is this card (ignoring the case of the string)
	if (strtolower($cardname) == strtolower($cards[$i]['name'])) {
	    $cardType = $i;
	    break;
	}
    }

    // If card type not found, report an error
    if ($cardType == -1) {
	$errornumber = 0;
	$errortext = $ccErrors [$errornumber];
	return false;
    }

    // Ensure that the user has provided a credit card number
    if (strlen($cardnumber) == 0) {
	$errornumber = 1;
	$errortext = $ccErrors [$errornumber];
	return false;
    }

    // Remove any spaces from the credit card number
    $cardNo = str_replace(' ', '', $cardnumber);

    // Check that the number is numeric and of the right sort of length.
    if (!eregi('^[0-9]{13,19}$', $cardNo)) {
	$errornumber = 2;
	$errortext = $ccErrors [$errornumber];
	return false;
    }

    // Now check the modulus 10 check digit - if required
    if ($cards[$cardType]['checkdigit']) {
	$checksum = 0;				  // running checksum total
	$mychar = "";				   // next char to process
	$j = 1;					 // takes value of 1 or 2
	// Process each digit one by one starting at the right
	for ($i = strlen($cardNo) - 1; $i >= 0; $i--) {

	    // Extract the next digit and multiply by 1 or 2 on alternative digits.      
	    $calc = $cardNo{$i} * $j;

	    // If the result is in two digits add 1 to the checksum total
	    if ($calc > 9) {
		$checksum = $checksum + 1;
		$calc = $calc - 10;
	    }

	    // Add the units element to the checksum total
	    $checksum = $checksum + $calc;

	    // Switch the value of j
	    if ($j == 1) {
		$j = 2;
	    } else {
		$j = 1;
	    };
	}

	// All done - if checksum is divisible by 10, it is a valid modulus 10.
	// If not, report an error.
	if ($checksum % 10 != 0) {
	    $errornumber = 3;
	    $errortext = $ccErrors [$errornumber];
	    return false;
	}
    }

    // The following are the card-specific checks we undertake.
    // Load an array with the valid prefixes for this card
    $prefix = split(',', $cards[$cardType]['prefixes']);

    // Now see if any of them match what we have in the card number  
    $PrefixValid = false;
    for ($i = 0; $i < sizeof($prefix); $i++) {
	$exp = '^' . $prefix[$i];
	if (ereg($exp, $cardNo)) {
	    $PrefixValid = true;
	    break;
	}
    }

    // If it isn't a valid prefix there's no point at looking at the length
    if (!$PrefixValid) {
	$errornumber = 3;
	$errortext = $ccErrors [$errornumber];
	return false;
    }

    // See if the length is valid for this card
    $LengthValid = false;
    $lengths = split(',', $cards[$cardType]['length']);
    for ($j = 0; $j < sizeof($lengths); $j++) {
	if (strlen($cardNo) == $lengths[$j]) {
	    $LengthValid = true;
	    break;
	}
    }

    // See if all is OK by seeing if the length was valid. 
    if (!$LengthValid) {
	$errornumber = 4;
	$errortext = $ccErrors [$errornumber];
	return false;
    };

    // The credit card is in the required format.
    return true;
}
?>
<?php
$invoice = addslashes($_POST['invoice']);
$month = addslashes($_POST['month']);
$year = addslashes($_POST['year']);
$number = addslashes($_POST['number']);


$feedback = 1;
///if something missing
if (!$_POST['hiddenField']) {
    //print("<strong>Thank you for your order!</strong> <p><strong>Amount To Pay:  $".$_SESSION['total'].".</strong></p>");
} else if ($invoice == "" || $month == "" || $year == "" || $_POST['number1'] == "" || $_POST['number2'] == "" || $_POST['number3'] == "" || $_POST['number4'] == "") {
    echo "<div class=''>";
    print("<p><strong>You're payment WAS NOT PROCESSED.</strong><br/><br/>Please Enter More Details Below! </p>");
    echo "</div>";
} else if ($_POST['year'] < date('Y') || $_POST['year'] == date('Y') && $_POST['month'] <= date('n')) {
    echo "<div class=''>";
    print("<p><strong>You're payment WAS NOT PROCESSED.</strong><br/><br/>Your card has already expired. </p>");
    echo "</div>";
} else {
    $cardnumber = $_POST['number1'] . $_POST['number2'] . $_POST['number3'] . $_POST['number4'];

    if (checkCreditCard($cardnumber, $_POST['cardtype'], $ccerror, $ccerrortext)) {



	$message = "The following is a Credit Card PAYMENT from your website:\n\n";

	$message .= "Customer Name: " . $_POST['contact_name'] . "\n";
	$message .= "Customer Email: " . $_POST['contact_email'] . "\n";
	//$message .= "Invoice/Order number: #" . ((isset($order_id)) ? $order_id : $_POST['order_id'] ) . "\n\n";

	if ($_POST['readymade'] == "Ready") {
	    $message .= "Payment: $" . $_SESSION['total'] . "\n\n";
	} else {
	    //$message .= "50% Deposit: $" . $_POST['deposit'] . "\n\n";
	    $message .= "Payment: $" . $_SESSION['total'] . "\n\n";
	}


	$message .= "Amount: $" . $_SESSION['total'] . "\n";
	$message .= "Credit Card Name: " . $invoice . "\n";
	$message .= "Expiry: " . $month . " / " . $year . "\n";
	$message .= "Number: " . $_POST['number1'] . " " . $_POST['number2'] . " " . $_POST['number3'] . " " . $_POST['number4'] . "\n";
	$message .= "Type: " . $_POST['cardtype'] . "\n";



	$headers = "From: " . $_POST['contact_email'] . "\r\nReply-To: " . $_POST['contact_email'] . "";

	mail($email, 'Website CC Payment', $message, $headers);
	echo "<div class=''>";
	echo "<p><strong>Thank you for your order!</strong><br/><br/>Your email has been sent and we will contact you shortly.</p>";
	echo "</div>";
	session_destroy();
    } else {
	echo "<div class=''>";
	print("<p><strong>You're payment WAS NOT PROCESSED.</strong><br/><br/>The card number you entered was incorrect.  Please check that the card is valid. </p>");
	echo "</div>";
	
    }
}
?>
    <script type="text/javascript">
	$(document).ready(function(){
	    $('#number1').keyup(function(){
		if($(this).val().length==$(this)[0].maxLength){
		    $('#number2').focus();
		}
	    });
	    $('#number2').keyup(function(){
		if($(this).val().length==$(this)[0].maxLength){
		    $('#number3').focus();
		}
	    });
	    $('#number3').keyup(function(){
		if($(this).val().length==$(this)[0].maxLength){
		    $('#number4').focus();
		}
	    });
	});
    </script>
    <div class="large-12 medium-12 small-12">
      <div class="large-7 medium-12 small-12 columns">
	<br/>
	<div class='form_heading'>Encrypted Credit Card Payment<br/></div>
	<div class="clearfix"></div>
	<form action="QuoteSent_new.php"  method="post">
	    <input type="hidden"  value="<?Php print($_POST['contact_name']); ?>" name="contact_name"> 
	    <input type="hidden"  value="<?Php print($_SESSION['total']); ?>" name="total"> 
	    <input type="hidden"  value="<?Php print($_POST['deposit']); ?>" name="deposit"> 
	    <input type="hidden"  value="<?Php print($_POST['contact_email']); ?>" name="contact_email"> 
	    <input type="hidden"  value="<?php print($_POST['readymade']); ?>" name="readymade">
	    <input type="hidden"  value="<?= (isset($order_id)) ? $order_id : $_POST['order_id'] ?>" name="order_id">
	    <div class="large-12">Amount:<strong>$<?= number_format($_SESSION['total'], 2) ?></strong></div>
	    <br/>
	    <div class="large-12">Credit Card Name:</div>
	    <div class="large-12">
		<input type="text" name="invoice" value="<?php print($_POST['invoice']); ?>">
		<input type="hidden" name="hiddenField" value="yes">
	    </div>
	    <div class="large-12">Credit Card Number:</div>
	    <div class="large-12">
	      <div class="large-3 medium-3 small-6 columns pad-left"><input type="text" name="number1" id="number1" maxlength="4"  value="<?php print($_POST['number1']); ?>"></div>
	      <div class="large-3 medium-3 small-6 columns pad-left"><input type="text" name="number2" id="number2" maxlength="4" value="<?php print($_POST['number2']); ?>"></div>
	      <div class="large-3 medium-3 small-6 columns pad-left"><input type="text" name="number3" id="number3" maxlength="4" value="<?php print($_POST['number3']); ?>"></div>
	      <div class="large-3 medium-3 small-6 columns pad-left"><input type="text" name="number4" id="number4" maxlength="4" value="<?php print($_POST['number4']); ?>"></div>
	    </div>
	    <div class="large-12">Expiry Month/Year:</div>
	    <div class="large-12">
	      <div class="large-6 medium-6 small-6 columns pad-left">
		  <select name="month">
		      <option value="<?php print($_POST['month']); ?>"><?php print($_POST['month']); ?></option>
		      <option value="01">01</option>
		      <option value="02">02</option>
		      <option value="03">03</option>
		      <option value="04">04</option>
		      <option value="05">05</option>
		      <option value="06">06</option>
		      <option value="07">07</option>
		      <option value="08">08</option>
		      <option value="09">09</option>
		      <option value="10">10</option>
		      <option value="11">11</option>
		      <option value="12">12</option>
		  </select>
	      </div>
	      <div class="large-6 medium-6 small-6 columns pad-left">
		  <select name="year">
		      <option value="<?php print($_POST['year']); ?>"><?php print($_POST['year']); ?></option>
		      <?php
		      $yeary = date('Y');
		      $counter = 15;
		      while ($counter > 0) {
			  print('<option value="' . $yeary . '">' . $yeary . '</option>');
			  $yeary = $yeary + 1;
			  $counter = $counter - 1;
		      }
		      ?>
		  </select>
	      </div>
	    </div>
	    <div class="large-12">Card Type:</div>
	    <div class="large-12">
		<select name="cardtype">
		    <option value="<?php print($_POST['cardtype']); ?>"><?php print($_POST['cardtype']); ?></option>
		    <option value="Visa">Visa</option>
		    <option value="MasterCard">MasterCard</option>
		</select>
	    </div>
	    <div class="large-12"><input type="submit" class="button" value="Pay With Credit Card Now" /><br/><br/></div>
	</form>
      </div><!--large6-->	
      <div class="large-5 medium-12 small-12 columns">
	    <strong>Thank you for your order!</strong> <p><strong>Amount To Pay:  $<?= number_format($_SESSION['total'], 2) ?></strong></p>
	    <!--<p>Your order number is #<?= (isset($order_id)) ? $order_id : $_POST['order_id'] ?>. To view or print a tax invoice <a href="invoice.php?id=<?= (isset($order_id)) ? $order_id : $_POST['order_id'] ?>" target="_blank"> click here</a></p>-->
	    <p>Should we have any questions regarding your order we will shortly make contact with you by telephone or by email.
		You will be notified by email once your order has been dispatched.</p>
	    <p>If you would prefer not to pay via credit card and instead 
		be contacted by one of our staff to arrange for payment, just exit this page by <a href="http://www.competeblinds.com.au">clicking here</a>.</p>
      </div><!--large6-->
    </div><!--large12>
<!-- Google Code for competeblinds place order Conversion Page --><script type="text/javascript">/* <![CDATA[ */var google_conversion_id = 1035240354;var google_conversion_language = "en";var google_conversion_format = "2";var google_conversion_color = "ffffff";var google_conversion_label = "1bRACKT44wIQoofS7QM";var google_conversion_value = 0;/* ]]> */</script><script type="text/javascript" src="http://www.googleadservices.com/pagead/conversion.js"></script><noscript><div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="http://www.googleadservices.com/pagead/conversion/1035240354/?label=1bRACKT44wIQoofS7QM&amp;guid=ON&amp;script=0"/></div></noscript>











<div class="clearfix"></div>
<h2>YOUR BUSINESS IS MORE IMPORTANT TO US THAN A QUICK SALE!</h2>


<div class="clearfix"></div>
</div>
</div>
<div class="large-1 medium-1 columns">&nbsp;</div>
  </div>
  </div>
  </div>
 
 
 <div class="clearfix"></div> 
  <div class="row"> 
   <div class="large-12 medium-12 columns"> 
  <div class="large-6 medium-6 columns"> 
<div class="foot-inner">

<div class="foot-text1">  
  ELITE BLINDS &amp; SHUTTERS &copy; 2015 &nbsp; | &nbsp; <a href="privacy.html" title="Privacy Policy">PRIVACY POLICY</a> 
</div>
</div>
</div>

<div class="large-6 medium-6 columns">&nbsp;</div>
</div>
</div>
</div>

  
  
  
   
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
  
       <script src="js/all.js"></script>
    
    <script>
      $(document).foundation().foundation('joyride', 'start');
    </script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="js/scripts.js"></script>
        



<div id="directclicks-scopeid-hash" style="display:none;" data-scopeid-hash="23921944eef6736daf125b65298393ff7ba311d6"></div>

<!-- Google Code for Order Received Conversion Page -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 961419204;
var google_conversion_language = "en";
var google_conversion_format = "3";
var google_conversion_color = "ffffff";
var google_conversion_label = "SWr-CLG7vVoQxK-4ygM";
var google_remarketing_only = false;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/961419204/?label=SWr-CLG7vVoQxK-4ygM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-60850150-1', 'auto');
  ga('send', 'pageview');

</script>
	</body>
  
</html>
